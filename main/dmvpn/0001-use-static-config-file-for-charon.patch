From 2bb2a86ee33c51b22b497b869ce22f4530704e77 Mon Sep 17 00:00:00 2001
From: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
Date: Sat, 15 Feb 2020 18:44:04 +0200
Subject: [PATCH 1/5] use static config file for charon

---
 dmvpn.charon | 8 ++++++++
 setup-dmvpn  | 7 ++-----
 2 files changed, 10 insertions(+), 5 deletions(-)
 create mode 100644 dmvpn.charon

diff --git a/dmvpn.charon b/dmvpn.charon
new file mode 100644
index 0000000..dd93b8a
--- /dev/null
+++ b/dmvpn.charon
@@ -0,0 +1,8 @@
+# Copyright (c) 2017-2020 Kaarle Ritvanen
+# See LICENSE file for license details
+
+charon {
+	x509 {
+		enforce_critical = no
+	}
+}
diff --git a/setup-dmvpn b/setup-dmvpn
index 3c1b461..0e7d9a2 100755
--- a/setup-dmvpn
+++ b/setup-dmvpn
@@ -1,7 +1,7 @@
 #!/bin/sh -e
 
 # Dynamic Multipoint VPN setup script for Alpine Linux
-# Copyright (c) 2017-2019 Kaarle Ritvanen
+# Copyright (c) 2017-2020 Kaarle Ritvanen
 # See LICENSE file for license details
 
 
@@ -237,10 +237,7 @@ EOF
 fi
 
 
-augtool -s <<EOF
-set /files/etc/conf.d/nhrpd/rc_need '"charon nhrp-events"'
-set /files/etc/strongswan.d/charon.conf/charon/x509/enforce_critical no
-EOF
+augtool -s "set /files/etc/conf.d/nhrpd/rc_need '\"charon nhrp-events\"'"
 
 for serv in charon zebra; do
 	is_active $serv && rc-service $serv stop
-- 
2.24.1

